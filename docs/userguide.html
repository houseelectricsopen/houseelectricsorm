<html>
<head>
    <title>userguide</title>
    <link rel="stylesheet" href="standardn.css" type="text/css">
</head>
<body bgcolor="black">

<div id="content">
    <table cellpadding="20">
        <tr>
            <td bgcolor="#eeeeee">
                <h1> House Electrics Orm User Guide </h1>

                <h2>Introduction</h2>

                <p>
                    This is an implementation of an object relational mapping for sqlite on android.
                    It contains a minimal set of features to map a java object model to a relational database in an android app but nevertheless places a low burden on the developer.
                </p>

                <p>
                    Here are some of the features:<br />
                    <ul>
                        <li>No database ids in domain objects – sqlite rowid is mapped internally to java domain object instances.</li>
                        <li>List Support</li>
                        <li>Polymorphic References</li>
                        <li>Customizeable type to db field mapping</b></li>
                        <li>Raw query s</li>
                        <li>Lazy Loading</li>
                    </ul>
                Here is what is planned:<br />
                <ul>
                    <li>Model distinction between contained and non contained relationships - to enable cascade delete</li>
                    <li>More lazy loading tests</li>
                    <li>Data migration / multiple concurrent schema version support</li>

                </ul>
                </p>

                <h2>Support - Appeal for Comments</h2>
                email support:
                <a href="mailto:codesupport@houseelectrics.com?Subject=Help!">codesupport@houseelectrics.com</a>
                All queries and suggestions are welcome, particularly in the form of new (failing) unit tests

                <h2>Project Organisation</h2>
                <h3>Project homeelectricsormbase</h3>
                <ul>
                    <li>core code</li>
                    <li>A standard (non android) implementation– so the unit tests can be run easily on a mac or PC</li>
                    <li>Containers for the unit test that run the tests without android – classes SqliteJDBCCrudTest and SqliteJDBCLazyLoadingTest</b></li>

                </ul>

                <h3>Project homeelectricsormandroid</h3>
                <ul>
                    <li>android specific code</li>
                </ul>
                <h3>Project homeelectricsormandroitest</h3>
                <ul>
                    <li>an android app running all the unit tests</li>
                    <li>click on "run tests" to run the tests</li>
                </ul>

                <h2>A basic CRUD example</h2>
This is taken from houselectricsormandroidtest/AndroidOrmExamples

<h4>Define the data model - without database id columns</h4>
<pre>
    public static class TestRoot
    {
        private String name;
        public String getName() {return name;}
        public void setName(String value) {this.name=value;}
        private TestDetail testDetail;
        public TestDetail getTestDetail() {return testDetail;}
        public void setTestDetail(TestDetail value) {this.testDetail = value;}
        private List&lt;TestDetail> details = null;
        public List&lt;TestDetail> getDetails() {return details;}
        public void setDetails(List&lt;TestDetail> value) {this.details=value;}
    }

    public static class TestDetail
    {
       private String detailName;
       public String getDetailName() {return detailName;}
       public  void setDetailName(String value) {this.detailName=value;}
       private int detailId;
       public int getDetailId() {return detailId;}
       public void setDetailId(int value) {this.detailId=value;}
    }
 
</pre>
      <h4>Create or connect to the database</h4>
<pre>
        AndroidDbUtil androidDbUtil = new AndroidDbUtil();
        // determine the database location  (something like  xxxxxx/AndroidOrmExamples/testBasic.db)
        String dbAbsolutePath = androidDbUtil.getOrCreateExternalStorageDbPath("AndroidOrmExamples", "testBasic");
        // create a database service pointing at that location
        SqliteDatabaseAndroidService da = androidDbUtil.createDb(activity, dbAbsolutePath, true);
</pre>
       <h4>Create a database context based on the datamodel</h4>
<pre>
        // assume properties type in this package are references and Lists are references
        DbContext dbContext;
        dbContext = (new ReflectionDbContextFactory()).createFromRootClassAssumeReferencesWithinPackageOrLists(TestRoot.class);
        dbContext.setSqliteDBAndroidStyle(da);
        //create the db schema if necessary
        dbContext.createSchemaIfNotExists();
</pre>
           This results in creation of 3 tables:
                <ul>
                    <li>TestRoot - representing the TestRoot class</li>
                    <li>TestDetail - representing the TestDetail class</li>
                    <li>TestRoot_Details - representing the Details relationship from TestRoot to TestDetail</li>
                </ul>

    <h4> Create some data</h4>
<pre>
    TestRoot testRoot = new TestRoot();
    testRoot.setName("Top Cat");
    testRoot.setTestDetail(new TestDetail());
    testRoot.getTestDetail().setDetailName("Underdog");
    testRoot.setDetails(new ArrayList&lt;TestDetail>());
    testRoot.getDetails().add(new TestDetail());
    testRoot.getDetails().get(0).setDetailName("list item 1");
    testRoot.getDetails().get(0).setDetailId(321);
    testRoot.getDetails().add(new TestDetail());
    testRoot.getDetails().get(1).setDetailName("list item 2");
    testRoot.getDetails().get(1).setDetailId(432);

</pre>
    <h4>Add the objects to the context and save to database</h4>
<pre>
        dbContext.add(testRoot);
        // add an extra test object
        dbContext.add(new TestRoot());
        dbContext.saveChanges();
</pre>
    <h4>Create a new context for a clean test !</h4>
<pre>
       dbContext = (new ReflectionDbContextFactory()).createFromRootClassAssumeReferencesWithinPackageOrLists(TestRoot.class);
       dbContext.setSqliteDBAndroidStyle(da);
</pre>
    <h4>Retrieve the domain object with a query and check values against what was saved</h4>
<pre>
    List&lt;Object> roots = dbContext.getAllByTypeShallow(TestRoot.class);
    asserter.assertEqual(roots.size(), 2);
    TestRoot retrievedTestRoot = (TestRoot) roots.get(0);
    retrievedTestRoot = (TestRoot) dbContext.deepLoad(retrievedTestRoot);

    asserter.assertEqual(retrievedTestRoot.getName(), testRoot.getName());
    asserter.assertEqual(retrievedTestRoot.getTestDetail().getDetailName(), testRoot.getTestDetail().getDetailName());
    asserter.assertEqual(retrievedTestRoot.getDetails().get(1).getDetailId(), testRoot.getDetails().get(1).getDetailId());
</pre>
  <h4>Make some change and update the database</h4>
<pre>
    retrievedTestRoot.getTestDetail().setDetailName("Top Dog");
    dbContext.update(retrievedTestRoot.getTestDetail());
    dbContext.delete(roots.get(1));
    dbContext.saveChanges();
</pre>
    <h4>Create a new context - for a clean test !</h4>
<pre>
    dbContext = (new ReflectionDbContextFactory()).createFromRootClassAssumeReferencesWithinPackageOrLists(TestRoot.class);
    dbContext.setSqliteDBAndroidStyle(da);
</pre>
   <h4>Retrieve objects and check changes have been saved</h4>
<pre>
    roots = dbContext.getAllByTypeShallow(TestRoot.class);
    //check the delete worked
    asserter.assertEqual(roots.size(), 1);
    //check the update worked
    TestRoot retrievedRoot0 = (TestRoot) roots.get(0);
    retrievedRoot0 = (TestRoot) dbContext.deepLoad(retrievedRoot0);
    asserter.assertEqual(retrievedRoot0.getTestDetail().getDetailName(), "Top Dog");
</pre>
            </td>
        </tr>
    </table>
</div>



</body>
 
    
</html>
